<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html lang='en'>
  <head>
    <title>Djinn::RelativeLocation</title>
    <meta content='text/html; charset=UTF-8' http-equiv='Content-Type'>
    <link href='../../css/style.css' media='screen' rel='stylesheet' type='text/css'>
    <script type='text/javascript'>
      //<![CDATA[
        function popupCode(url) {
          window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
        }
        
        function toggleCode(id) {
          var code = document.getElementById(id)
        
          code.style.display = code.style.display != 'block' ? 'block' : 'none'
          return true
        }
        
        // Make codeblocks hidden by default
        document.writeln('<' + 'style type="text/css">.method .source pre { display: none }<\/style>')
      //]]>
    </script>
  </head>
  <body class='page'>
    <div class='class' id='wrapper'>
      <div class='header'>
        <h1 class='name'>
          <span class='type'>class</span>
          Djinn::RelativeLocation
        </h1>
        <ol class='paths'>
          <li>
            <a target="docwin" href="../../files/djinn_restserver_rb.html">djinn_restserver.rb</a>
          </li>
        </ol>
        <div class='parent'>
          Parent:
          <strong><a target="docwin" href="../Djinn.html">Djinn</a></strong>
        </div>
      </div>
      <div id='content'>
        <div id='text'>
          <div id='description'>
            
            <p>Rack middleware, inspired by Rack::RelativeRedirect. Differences:</p>
            <ul><li>
            <p>uses Rack::Utils::base_uri for creating absolute URIs.</p>
            </li><li>
            <p>the <code>Location:</code> header, if present, is always rectified,
            independent of the HTTP status code.</p>
            </li></ul>
          </div>
          <div id='method-list'>
            <h2>Methods</h2>
            <h3>Public Class</h3>
            <ol>
              <li><a target="docwin" href="#method-c-new">new</a></li>
            </ol>
            <h3>Public Instance</h3>
            <ol>
              <li><a target="docwin" href="#method-i-call">call</a></li>
            </ol>
          </div>
          <div id='context'>
          </div>
          <div id='section'>
            <div id='methods'>
              <h2>Public Class methods</h2>
              <div class='method public-class' id='method-method-c-new'>
                <a name='method-c-new'></a>
                <div class='synopsis'>
                  <span class='name'>new</span>
                  <span class='arguments'>(app)</span>
                </div>
                <div class='description'>
                  
                  <p>Initialize a new RelativeRedirect object with the given arguments. 
                  Arguments:</p>
                  <ul><li>
                  <p>app : The next middleware in the chain.  This is always called.</p>
                  </li><li>
                  <p>&amp;block : If provided, it is called with the environment and the
                  response from the next middleware. It should return a string representing
                  the scheme and server name (such as ‘<a
                  href="http://example.org">example.org</a>’).</p>
                  </li></ul>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('method-c-new-source'); return false">
                    [show source]
                  </a>
                  <pre id='method-c-new-source'><span class="ruby-comment"># File djinn_restserver.rb, line 294</span>&#x000A;<span class="ruby-keyword">def</span> <span class="ruby-identifier">initialize</span>(<span class="ruby-identifier">app</span>)&#x000A;  <span class="ruby-ivar">@app</span> = <span class="ruby-identifier">app</span>&#x000A;<span class="ruby-keyword">end</span></pre>
                </div>
              </div>
              <h2>Public Instance methods</h2>
              <div class='method public-instance' id='method-method-i-call'>
                <a name='method-i-call'></a>
                <div class='synopsis'>
                  <span class='name'>call</span>
                  <span class='arguments'>(env)</span>
                </div>
                <div class='description'>
                  
                  <p>Call the next middleware with the environment.  If the request was a
                  redirect (response status 301, 302, or 303), and the location header does
                  not start with an http or https url scheme, call the block provided by new
                  and use that to make the Location header an absolute url.  If the Location
                  does not start with a slash, make location relative to the path requested.</p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('method-i-call-source'); return false">
                    [show source]
                  </a>
                  <pre id='method-i-call-source'><span class="ruby-comment"># File djinn_restserver.rb, line 304</span>&#x000A;<span class="ruby-keyword">def</span> <span class="ruby-identifier">call</span>(<span class="ruby-identifier">env</span>)&#x000A;  <span class="ruby-identifier">res</span> = <span class="ruby-ivar">@app</span>.<span class="ruby-identifier">call</span>(<span class="ruby-identifier">env</span>)&#x000A;  <span class="ruby-keyword">if</span> ( <span class="ruby-identifier">location</span> = <span class="ruby-identifier">res</span>[<span class="ruby-value">1</span>][<span class="ruby-string">'Location'</span>] ) <span class="ruby-keyword">and</span>&#x000A;     <span class="ruby-operator">!</span> <span class="ruby-regexp">%r{\A[a-z]+://}</span>.<span class="ruby-identifier">match</span>(<span class="ruby-identifier">location</span>)&#x000A;    <span class="ruby-identifier">request</span> = <span class="ruby-constant">Rack</span><span class="ruby-operator">::</span><span class="ruby-constant">Request</span>.<span class="ruby-identifier">new</span> <span class="ruby-identifier">env</span>&#x000A;    <span class="ruby-keyword">unless</span> <span class="ruby-string">'/'</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">location</span>[<span class="ruby-value">0</span>, <span class="ruby-value">1</span>]&#x000A;      <span class="ruby-identifier">path</span> = <span class="ruby-identifier">request</span>.<span class="ruby-identifier">path</span>.<span class="ruby-identifier">dup</span>&#x000A;      <span class="ruby-identifier">path</span>[ <span class="ruby-regexp">%r{[^/]*\z}</span> ] = <span class="ruby-string">''</span>&#x000A;      <span class="ruby-identifier">location</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">expand_path</span>( <span class="ruby-identifier">location</span>, <span class="ruby-identifier">path</span> )&#x000A;    <span class="ruby-keyword">end</span>&#x000A;    <span class="ruby-identifier">res</span>[<span class="ruby-value">1</span>][<span class="ruby-string">'Location'</span>] = <span class="ruby-identifier">request</span>.<span class="ruby-identifier">base_url</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">location</span>&#x000A;  <span class="ruby-keyword">end</span>&#x000A;  <span class="ruby-identifier">res</span>&#x000A;<span class="ruby-keyword">end</span></pre>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div id='footer-push'></div>
    </div>
    <div id='footer'>
      <a target="docwin" href="http://github.com/mislav/hanna/tree/master"><strong>Hanna</strong> RDoc template</a>
    </div>
  </body>
</html>
